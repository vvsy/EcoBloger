if (window.innerWidth < 1024) {
    var app = {
        wrapper : document.querySelector('#div-gpt-ad-1503996040247-0'),
        iframe : document.querySelector('#div-gpt-ad-1503996040247-0 iframe'),
        iframeWebsite: window.location.origin,
        distPercentage: 0.4, /* 判斷與頂端距離展開320x500 */
        loaded: false
    }
    window.addEventListener('scroll', adsAction, false);
    window.addEventListener('load', adsAction, false);
    window.addEventListener("message", handleIframeHeight, false);
    function adsAction() {
        // distance between element with window top edge.
        var dist = app.wrapper.getBoundingClientRect().top;
        app.iframe = app.wrapper.querySelector('#div-gpt-ad-1503996040247-0 iframe')
        var distShowComplete = window.innerHeight * app.distPercentage;
        if (dist <= distShowComplete) {
                app.iframe.contentWindow.postMessage('showComplete', app.iframeWebsite);
        }

        if (dist > distShowComplete && !app.loaded) {
            app.iframe.contentWindow.postMessage('showPreview', app.iframeWebsite);
            if(app.iframe.contentWindow.document.querySelector('#preview img')){
                app.loaded = !app.loaded
            }
        }
    }
    function handleIframeHeight(e) {
      if(e.data !== 'changeIframeHeight') return;
      app.iframe.style.height = 480+'px'
    }
}